name: Health Check

on:
  schedule:
    - cron: '*/15 * * * *'  # Every 15 minutes
  workflow_dispatch:

jobs:
  health-check:
    runs-on: ubuntu-latest
    steps:
    - name: Check Backend Health
      run: |
        BACKEND_URL="${{ secrets.BACKEND_URL }}"
        if [ -z "$BACKEND_URL" ]; then
          echo "‚ö†Ô∏è  BACKEND_URL not set in secrets"
          exit 0
        fi
        
        echo "Checking backend health: $BACKEND_URL/health"
        curl -f "$BACKEND_URL/health" || {
          echo "‚ùå Backend health check failed"
          exit 1
        }
        echo "‚úÖ Backend is healthy"
        
    - name: Check Frontend
      run: |
        FRONTEND_URL="${{ secrets.FRONTEND_URL }}"
        if [ -z "$FRONTEND_URL" ]; then
          echo "‚ö†Ô∏è  FRONTEND_URL not set in secrets"
          exit 0
        fi
        
        echo "Checking frontend: $FRONTEND_URL"
        curl -f "$FRONTEND_URL" || {
          echo "‚ùå Frontend health check failed"
          exit 1
        }
        echo "‚úÖ Frontend is accessible"

    - name: Performance Test
      run: |
        echo "üöÄ Running quick performance test..."
        BACKEND_URL="${{ secrets.BACKEND_URL }}"
        if [ ! -z "$BACKEND_URL" ]; then
          time curl -X POST "$BACKEND_URL/analyze" \
            -H "Content-Type: application/json" \
            -d '{"content":"This is a test message","platform":"general"}' || echo "Performance test failed"
        fi